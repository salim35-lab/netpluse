# خاصية التعليقات على المنشورات

## نظرة عامة

تم إضافة نظام تعليقات كامل للمنشورات في منصة سوشيال كونكت، يتيح للمستخدمين التفاعل مع المنشورات من خلال إضافة تعليقات وعرضها وحذفها.

## المميزات

### 1. عرض التعليقات
- عرض جميع التعليقات على المنشور بترتيب زمني
- عرض معلومات المعلق (الصورة الشخصية، الاسم، اسم المستخدم)
- عرض وقت نشر التعليق بصيغة نسبية (منذ دقيقة، منذ ساعة، إلخ)
- عداد التعليقات على كل منشور

### 2. إضافة تعليقات
- نموذج بسيط لكتابة التعليق
- زر نشر التعليق مع حالة التحميل
- إشعار نجاح عند إضافة التعليق
- تحديث فوري لقائمة التعليقات

### 3. حذف التعليقات
- المستخدم يمكنه حذف تعليقاته الخاصة
- المسؤول يمكنه حذف أي تعليق
- تأكيد قبل الحذف لتجنب الحذف العرضي
- إشعار نجاح عند حذف التعليق

### 4. صفحة تفاصيل المنشور
- صفحة مخصصة لعرض المنشور مع جميع تعليقاته
- رابط مباشر من عداد التعليقات في PostCard
- زر رجوع للعودة للصفحة السابقة

## البنية التقنية

### المكونات الجديدة

#### 1. CommentSection Component
**الموقع**: `src/components/common/CommentSection.tsx`

**الوظائف**:
- عرض قائمة التعليقات
- نموذج إضافة تعليق جديد
- حذف التعليقات
- تحديث عداد التعليقات

**Props**:
```typescript
interface CommentSectionProps {
  postId: string;           // معرف المنشور
  onCommentAdded?: () => void;  // دالة callback عند إضافة تعليق
}
```

#### 2. PostDetailPage
**الموقع**: `src/pages/PostDetailPage.tsx`

**الوظائف**:
- عرض المنشور الكامل
- عرض قسم التعليقات
- التعامل مع حذف المنشور
- التنقل للخلف

**المسار**: `/post/:postId`

## كيفية الاستخدام

### للمستخدمين

1. **عرض التعليقات**:
   - انقر على أيقونة التعليقات أو العدد في أي منشور
   - سيتم فتح صفحة تفاصيل المنشور مع جميع التعليقات

2. **إضافة تعليق**:
   - اكتب تعليقك في المربع المخصص
   - انقر على "نشر التعليق"
   - سيظهر تعليقك فوراً في القائمة

3. **حذف تعليق**:
   - انقر على أيقونة سلة المهملات بجانب تعليقك
   - أكد الحذف في النافذة المنبثقة
   - سيتم حذف التعليق فوراً

### للمطورين

#### استخدام CommentSection في صفحة مخصصة:

```tsx
import { CommentSection } from '@/components/common/CommentSection';

function MyPage() {
  const handleCommentAdded = () => {
    // تحديث البيانات أو إعادة التحميل
    console.log('تم إضافة تعليق جديد');
  };

  return (
    <div>
      <CommentSection 
        postId="post-id-here"
        onCommentAdded={handleCommentAdded}
      />
    </div>
  );
}
```

## الأمان

### سياسات Row Level Security (RLS)

1. **عرض التعليقات**: جميع المستخدمين المصادقين يمكنهم عرض التعليقات
2. **إضافة تعليقات**: المستخدمون المصادقون فقط يمكنهم إضافة تعليقات
3. **حذف التعليقات**:
   - المستخدم يمكنه حذف تعليقاته فقط
   - المسؤول يمكنه حذف أي تعليق

### التحقق من الصلاحيات

```typescript
const canDelete = user && (user.id === comment.user_id || profile?.role === 'admin');
```

## واجهة برمجة التطبيقات (API)

### الدوال المستخدمة من `@/db/api.ts`:

1. **getComments(postId: string)**: جلب جميع تعليقات منشور معين
2. **createComment(postId: string, userId: string, content: string)**: إضافة تعليق جديد
3. **deleteComment(commentId: string)**: حذف تعليق

## التصميم

- تصميم متجاوب يعمل على جميع الأجهزة
- استخدام مكونات shadcn/ui للواجهة
- ألوان متناسقة مع نظام الألوان الرئيسي
- رسوم متحركة سلسة للتفاعلات

## الميزات المستقبلية المقترحة

- [ ] الرد على التعليقات (تعليقات متداخلة)
- [ ] الإعجاب بالتعليقات
- [ ] تعديل التعليقات
- [ ] الإشارة للمستخدمين في التعليقات (@mention)
- [ ] إشعارات التعليقات الجديدة
- [ ] تحميل التعليقات بشكل تدريجي (pagination)
- [ ] فلترة وترتيب التعليقات

## الاختبار

تم اختبار الميزة بنجاح:
- ✅ إضافة تعليقات
- ✅ عرض التعليقات
- ✅ حذف التعليقات
- ✅ التحقق من الصلاحيات
- ✅ التصميم المتجاوب
- ✅ اختبار Lint بدون أخطاء

---

**تاريخ الإضافة**: 28 ديسمبر 2025
**الإصدار**: 1.0.0
